<progress
	id="reading-progress-bar"
	class="[&::-webkit-progress-bar]:bg-foreground/20 dark:[&::-moz-progress-bar]:bg-foreground dark:[&::-webkit-progress-value]:bg-foreground fixed top-0 z-50 h-1 w-full [&::-moz-progress-bar]:bg-blue-400 [&::-webkit-progress-bar]:rounded-lg [&::-webkit-progress-value]:rounded-lg [&::-webkit-progress-value]:bg-blue-400"
	max="100"
	value="0"
	aria-label="Reading progress"></progress>

<script>
	const setupReadingIndicator = () => {
		const progressBar = document.getElementById(
			"reading-progress-bar",
		) as HTMLProgressElement;

		if (!progressBar) return;

		const updateProgressBar = () => {
			const { scrollTop, scrollHeight, clientHeight } =
				document.documentElement;

			if (scrollHeight === clientHeight) {
				progressBar.value = 0;
				return;
			}

			const scrollPercent =
				(scrollTop / (scrollHeight - clientHeight)) * 100;

			progressBar.value = scrollPercent;
		};

		// Clean up previous listeners to avoid duplicates.
		document.removeEventListener("scroll", updateProgressBar);
		document.removeEventListener("resize", updateProgressBar);
		document.addEventListener("scroll", updateProgressBar);
		document.addEventListener("resize", updateProgressBar);

		// Sets the initial progress value, in case the user is not at the top.
		updateProgressBar();
	};

	document.addEventListener("astro:page-load", setupReadingIndicator);
</script>
